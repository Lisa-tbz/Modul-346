# KN09 — Automatisierung

**Datum:** 24.12.2025

---
# Teil A - Automatisierung mit CLI
### Details der erstellten Instanz
Sidenote: Das ist die gleiche Instanz, die erstellt und danach noch gestartet/gestoppt wurde,
da der Autoscaler von KN07 uns beim stoppen einer dieser Instanzen einen Strich durch die Rechnung machte.

![instancedetails.png](images/instancedetails.png)

### Commands + Console Output

#### aws ec2 describe-instances
```powershell
...
"InstanceId": "i-053ce25a43793c8bb",
"ImageId": "ami-0277318887678083b",
"State": {
"Code": 16,
"Name": "running"
}
...
```
#### aws ec2 stop-instances --instance-ids i-053ce25a43793c8bb
```powershell
{
"StoppingInstances": [
{
"InstanceId": "i-053ce25a43793c8bb",
"CurrentState": {
"Code": 64,
"Name": "stopping"
},
"PreviousState": {
"Code": 16,
"Name": "running"
}}]}
```
#### aws ec2 start-instances --instance-ids i-053ce25a43793c8bb
```powershell
{
"StartingInstances": [
{
"InstanceId": "i-053ce25a43793c8bb",
"CurrentState": {
"Code": 0,
"Name": "pending"
},
"PreviousState": {
"Code": 80,
"Name": "stopped"
}}]}
```

### Telnet
![telnet.png](images/telnet.png)

### CLI-Commands für KN05
#### VPC erstellen
```powershell
aws ec2 create-vpc \
--cidr-block 10.0.0.0/16 \
--tag-specifications ResourceType=vpc,Tags=[{Key=Name,Value=vpc-kn05}]
```
#### Subnetz erstellen
```powershell
aws ec2 create-subnet \
--vpc-id vpc-EXAMPLE \
--cidr-block 10.0.1.0/24 \
--tag-specifications ResourceType=subnet,Tags=[{Key=Name,Value=sub-kn04}]
```
#### Security Group erstellen
```powershell
aws ec2 create-security-group \
--group-name SG-Webserver \
--description "something" \
--vpc-id vpc-EXAMPLE

aws ec2 create-security-group \
--group-name SG-Database \
--description "something 2.0" \
--vpc-id vpc-EXAMPLE
```
#### Inbound-Rules setzen
```powershell
aws ec2 authorize-security-group-ingress \
--group-id sg-WEB-EXAMPLE --protocol tcp --port 80 --cidr 0.0.0.0/0

aws ec2 authorize-security-group-ingress \
--group-id sg-WEB-EXAMPLE --protocol tcp --port 443 --cidr 0.0.0.0/0

aws ec2 authorize-security-group-ingress \
--group-id sg-WEB-EXAMPLE --protocol tcp --port 22 --cidr 0.0.0.0/0

aws ec2 authorize-security-group-ingress \
--group-id sg-DB-EXAMPLE --protocol tcp --port 3306 --cidr 10.0.2.0/24
```
#### Elastic IP für Webserver
```powershell
aws ec2 allocate-address \
--domain vpc \
--tag-specifications ResourceType=elastic-ip,Tags=[{Key=Name,Value=ip-web}]
```
#### Netzwerkinterface erstellen
```powershell
aws ec2 create-network-interface \
--subnet-id subnet-KN05-EXAMPLE \
--private-ip-address 10.0.2.10 \
--groups sg-WEB-EXAMPLE \
--tag-specifications ResourceType=network-interface,Tags=[{Key=Name,Value=eni-web-kn05}]
```
#### Instanze erstellen
```powershell
aws ec2 run-instances \
--image-id ami-EXAMPLE \
--instance-type t2.micro \
--network-interfaces NetworkInterfaceId=eni-web-kn05,DeviceIndex=0 \
--tag-specifications ResourceType=instance,Tags=[{Key=Name,Value=web-kn05}]
```
#### Elastic IP einer Instanz zuweisen
```powershell
aws ec2 associate-address \
--allocation-id eipalloc-EXAMPLE \
--network-interface-id eni-web-kn05
```
#### Instanz stoppen
```powershell
aws ec2 stop-instances --instance-ids i-WEB-EXAMPLE i-DB-EXAMPLE
```

### Automatisierung
Man sollte überprüfen, ob alle Werte abhängig voneinander gesetzt sind (bspw. als Umgebungsvariablen).
Das VPC muss z.B. vor den Subnetzen erstellt werden.
Wenn möglich sollten IPs statisch sein, damit sie sich nicht immer ändern. (oder abgespeichert in einer conf-Datei)
Terraform eignet sich gut für diesen Task, da es Abhängigkeiten selbst verwaltet.

# Teil B - TerraForm

### Terraform Commands
#### Initialisierung
![init.png](images/init.png)

#### Änderungen planen
![plan.png](images/plan.png)

#### Änderungen durchführen
![apply1.png](images/apply1.png)
![apply2.png](images/apply2.png)

### Telnet
![telnet2.png](images/telnet2.png)

### Vorteile von Terraform
Terraform erkennt Abhängigkeiten automatisch, wenn also die Instanz die SG braucht,
erstellt Terraform diese zuerst. Wir müssen also nur schreiben, was wir wollen und uns nicht
um side-effects kümmern. Man kann Pläne auch speichern (output), was den Prozess wiederholbar macht.
(Stichwort Automatisierung)
